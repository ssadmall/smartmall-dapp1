<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Smart Mall DApp</title>
  <style>
        /* ===== CHUNG ===== */
    body{background:#0a1a2f;color:#fff;font-family:Arial,sans-serif;margin:0;padding-bottom:100px}
    section{display:none;padding:20px;margin:10px;background:#162447;border-radius:8px;border:2px solid #21e6c1}
    section.show{display:block}
    h2{color:#21e6c1;margin:0 0 12px}
    button,input,code{border:none;border-radius:4px}
    button{background:#21e6c1;color:#0a1a2f;font-weight:bold;cursor:pointer;padding:8px;margin:6px 0;width:100%}
    button.small{width:auto;padding:6px 12px;margin:4px 2px}
    input{width:100%;padding:8px;margin:6px 0;background:#1f4068;color:#fff}
    .pos{color:#21b86c} /* xanh */
    .neg{color:#d03232} /* ƒë·ªè */
    /* NAV */
    nav{position:fixed;bottom:0;left:0;right:0;display:flex;background:#162447;border-top:2px solid #21e6c1;z-index:100}
    nav .nav-btn{flex:1;padding:10px 0;font-size:14px;background:#162447;color:#fff;cursor:pointer}
    nav .nav-btn.active,nav .nav-btn:hover{background:#21e6c1;color:#162447}
    /* VIP/S-LEVEL */
    #ranks{border:2px solid #21e6c1;background:#1b2c45;padding:12px;border-radius:8px;margin-bottom:16px}
    #ranks h3{margin:0 0 8px;color:#21e6c1}
    #ranks p{margin:4px 0}
    /* V√ç */
    .wallet-box{border:2px solid #21e6c1;background:#1b2c45;padding:12px;border-radius:8px;margin:8px 0}
    .wallet-box h4{margin:0 0 8px;color:#21e6c1}
    .wallet-box p{margin:4px 0}
    /* DATE TABS */
    .date-tab-bar{display:flex;overflow-x:auto;background:#1b2c45;padding:6px;border-radius:8px;margin:12px 0}
    .date-tab-bar button{flex:0 0 auto;margin:0 4px;padding:6px 12px;background:#0f1c2e;color:#ccc;font-size:13px;cursor:pointer;white-space:nowrap}
    .date-tab-bar button.active{background:#21e6c1;color:#162447;font-weight:bold}
    /* LIST */
    .list{display:flex;flex-direction:column;gap:10px}
    .product,.sale-item,.nft-item{padding:10px;border-radius:6px;color:#fff}
    .product{background:#283e51}
    .sale-item{background:#344861}
    .nft-item{background:#1b2c45}
    /* MODAL */
    .modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);justify-content:center;align-items:center}
    .modal.show{display:flex!important}
    .modal-content{background:#fff;color:#000;padding:20px;border-radius:8px;width:90%;max-width:360px}
    /* RESPONSIVE */
    @media(max-width:480px){nav .nav-btn{font-size:12px;padding:8px 0}button,input{font-size:14px}}
  </style>
</head>
<body>

  <!-- LOGIN -->
  <section id="login" class="show">
    <h2>üîë ƒêƒÉng nh·∫≠p</h2>
    <input id="usernameInput" placeholder="Nh·∫≠p username (vi·∫øt li·ªÅn)" />
    <button id="loginBtn">Ti·∫øp t·ª•c</button>
  </section>

  <!-- APP -->
  <div id="app" style="display:none">

    <!-- NAV -->
    <nav>
      <button id="btn-home"    class="nav-btn active" onclick="showSection('home')">üè† Trang ch·ªß</button>
      <button id="btn-session" class="nav-btn"         onclick="showSection('session')">‚è±Ô∏è Phi√™n</button>
      <button id="btn-nft"     class="nav-btn"         onclick="showSection('nft')">üßæ NFT</button>
      <button id="btn-wallet"  class="nav-btn"         onclick="showSection('wallet')">üí∞ V√≠</button>
      <button id="btn-profile" class="nav-btn"         onclick="showSection('profile')">üë§ Th√¥ng tin</button>
    </nav>

    <!-- HOME -->
    <section id="home" class="show">
      <h2>üì¢ Th√¥ng b√°o t·ª´ Smart Mall</h2>
      <div class="marquee"><span>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Smart Mall ‚Äì Giao d·ªãch th√¥ng minh!</span></div>
    </section>

    <!-- SESSION -->
    <section id="session">
      <h2>üïí Phi√™n giao d·ªãch</h2>
      <div class="date-tab-bar" id="sessionDateTabs"></div>
      <p>Phi√™n: <b id="selectedDateText"></b></p>
      <div id="registrationBox"><button onclick="showRegisterModal()">ƒêƒÉng k√Ω phi√™n (20 000 SMP)</button></div>
      <div id="joinContainer" style="display:none"><button class="small" onclick="joinSession()">Tham gia phi√™n</button></div>
      <div id="products" style="display:none">
        <h3>S·∫£n ph·∫©m h√¥m nay</h3>
        <div id="productList" class="list"></div>
        <h3>S·∫£n ph·∫©m treo b√°n</h3>
        <div id="pendingSaleList" class="list"></div>
      </div>
    </section>

    <!-- NFT -->
    <section id="nft">
      <h2>üßæ NFT c·ªßa t√¥i</h2>
      <div id="nftList">Ch∆∞a c√≥ s·∫£n ph·∫©m.</div>
      <p>T·ªïng chi ti√™u: <span id="totalSpent">0</span> SMP</p>
      <h3>L·ªãch s·ª≠ NFT</h3>
      <ul id="nftHistory">Ch∆∞a c√≥ l·ªãch s·ª≠.</ul>
    </section>

    <!-- WALLET -->
    <section id="wallet">
      <h2>üí∞ V√≠</h2>
      <div class="wallet-box"><h4>SMP ch√≠nh</h4><p><b id="walletBalance">0</b> SMP</p></div>
      <div class="wallet-box"><h4>Hoa h·ªìng tr·ª±c ti·∫øp</h4><p><b id="directCommission">0</b> SMP</p><button class="small" onclick="withdrawDirect()">R√∫t tr·ª±c ti·∫øp</button></div>
      <div class="wallet-box"><h4>Hoa h·ªìng c·∫•p b·∫≠c</h4><p><b id="rankCommission">0</b> SMP</p><button class="small" onclick="withdrawRank()">R√∫t c·∫•p b·∫≠c</button></div>
      <div class="wallet-tabs"><button onclick="showDeposit()">N·∫°p</button><button onclick="showTransfer()">Chuy·ªÉn</button><button onclick="showWithdraw()">R√∫t</button></div>
      <div id="walletAction"></div>
      <h3>L·ªãch s·ª≠ giao d·ªãch</h3><div id="walletHistory">Ch∆∞a c√≥.</div>
      <h3>L·ªãch s·ª≠ y√™u c·∫ßu</h3>
      <table><thead><tr><th>Lo·∫°i</th><th>SMP</th><th>USDT</th><th>ƒê·ªãa ch·ªâ</th><th>Th·ªùi gian</th><th>TT</th></tr></thead>
      <tbody id="requestHistory"></tbody></table>
    </section>

    <!-- PROFILE -->
    <section id="profile"
           >
      <h2>üë§ Th√¥ng tin c√° nh√¢n</h2>
      <p>Username: <b id="profileUsername"></b></p>
      <input id="phone" placeholder="S·ªë ƒëi·ªán tho·∫°i"/>
      <input id="fullname" placeholder="H·ªç t√™n ƒë·∫ßy ƒë·ªß"/>
      <input id="bep20" placeholder="V√≠ BEP20"/>
      <button onclick="saveProfile()">L∆∞u</button>
      <h3>üîó Referral</h3>
      <p><a id="referralLink" href="#" target="_blank"></a></p>
      <p>Tr·ª±c ti·∫øp: <span id="directRefCount">0</span>‚ÄÉƒê·ªôi nh√≥m: <span id="teamRefCount">0</span></p>
      <p>Doanh s·ªë nh√≥m: <b id="teamSalesDisplay">0</b> SMP</p>
      <div id="ranks"><h3>üéñÔ∏è C·∫•p b·∫≠c</h3><p>VIP: <b id="vipLevel">VIP0</b> (<span id="vipDays">0</span> ng√†y)</p><p>L·ª£i nhu·∫≠n: <b id="vipProfitRate">1.5%</b></p><hr style="border-color:#21e6c1;margin:6px 0;"><p>S-Level: <b id="sLevel">S0</b></p><p>Hoa h·ªìng ƒë·ªôi: <b id="sCommissionRate">0%</b></p></div>
    </section>

    <!-- MODALS -->
    <div class="modal" id="registerModal"><div class="modal-content"><h3>Ph√≠ ƒëƒÉng k√Ω: 20 000 SMP</h3><button onclick="confirmRegister()">X√°c nh√¢n</button><button onclick="closeRegisterModal()">H·ªßy</button></div></div>
    <div class="modal" id="sellModal"><div class="modal-content"><h3>B√°n NFT</h3><p>ID: <span id="sellId"></span></p><p>Gi√° mua: <b id="sellCost"></b> SMP</p><p>L·ª£i nhu·∫≠n: <b id="sellProfit"></b> SMP</p><p>Ph√≠ g·ª≠i b√°n: <b id="sellFee"></b> SMP</p><button onclick="confirmSell()">X√°c nh·∫≠n</button><button onclick="closeSellModal()">H·ªßy</button></div></div>
    <div class="modal" id="depositModal"><div class="modal-content"><h3>Chuy·ªÉn USDT BEP20</h3><code id="depositAddress">0xYourBEP20</code><button class="small" onclick="copyAddress()">Copy</button><p>Gi√° USDT: <span id="usdtPrice">26 400</span> SMP</p><input id="depositSMP" type="number" placeholder="SMP mu·ªën n·∫°p"/><p id="requiredUSDT">C·∫ßn: 0 USDT</p><button onclick="submitDeposit()">G·ª≠i y√™u c·∫ßu</button><button onclick="closeDepositModal()">H·ªßy</button></div></div>
    <div class="modal" id="withdrawModal"><div class="modal-content"><h3>R√∫t SMP (min 1 000 000)</h3><input id="withdrawAmt" type="number" placeholder="SMP r√∫t"/><button onclick="submitWithdraw()">G·ª≠i</button><button onclick="closeWithdrawModal()">H·ªßy</button></div></div>

  </div>

  <script>
    // ===== State & Helpers =====
    const state = {
      usdtPrice:26400,
      walletBalance:100000000000,
      directCommission:0,
      rankCommission:0,
      registrations:[],
      products:[],
      pendingSales:[],
      userNFT:[],
      walletHistory:[],
      requests:[],
      nftHistory:[],
      teamSales:0,
      members:[]
    };
    let currentUsername='', selectedDate='', sellContext=null;
    const fmt = n => n.toLocaleString('vi-VN');

    function randomId(){
      const c='abdcnuekcasepkz0123456789';
      let s='';
      for(let i=0;i<18;i++) s+=c[Math.floor(Math.random()*c.length)];
      return s;
    }
    function randomColor(){return `hsl(${Math.random()*360|0},40%,30%)`;}
    function addWalletHistory(desc,delta){state.walletHistory.unshift({desc,delta,time:new Date().toLocaleString('vi-VN')});renderWalletHistory();}
    function showSection(id){
      document.querySelectorAll('section').forEach(s=>s.classList.remove('show'));
      document.getElementById(id).classList.add('show');
      document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
      document.getElementById('btn-'+id).classList.add('active');
    }
    function updateWallet(){document.getElementById('walletBalance').innerText=fmt(state.walletBalance);}
    function updateCommissionUI(){document.getElementById('directCommission').innerText=fmt(state.directCommission);document.getElementById('rankCommission').innerText=fmt(state.rankCommission);document.getElementById('teamSalesDisplay').innerText=fmt(state.teamSales);}
    function vipRate(){return parseFloat(document.getElementById('vipProfitRate').innerText);}

    // ===== Init & Login =====
    document.getElementById('loginBtn').onclick=()=>{
      const u=document.getElementById('usernameInput').value.trim();
      if(!u) return alert('Nh·∫≠p username!');
      currentUsername=u;localStorage.setItem('sm_user',u);
      document.getElementById('login').classList.remove('show');
      document.getElementById('app').style.display='block';
      initApp();
    };
    window.onload=()=>{const u=localStorage.getItem('sm_user'); if(u){currentUsername=u;document.getElementById('login').classList.remove('show');document.getElementById('app').style.display='block';initApp();}};

    // ===== App Init =====
    function initApp(){
      ['NFT1','NFT2','NFT3','NFT4','NFT5','NFT6'].forEach((n,i)=> state.products.push({id:randomId(),name:n,price:[5000000,3000000,4500000,200000000,1000000000,2000000000][i],seller:'Admin'}));
      document.getElementById('profileUsername').innerText=currentUsername;
      generateTabs();updateWallet();renderProducts();renderPendingSales();renderNFTs();renderWalletHistory();renderRequestHistory();renderNFTHistory();updateVipLevel();updateSLevel();updateCommissionUI();
    }

    // ===== Session Tabs =====
    function generateTabs(){const c=document.getElementById('sessionDateTabs'),txt=document.getElementById('selectedDateText'),t=new Date();for(let i=0;i<7;i++){const d=new Date(t);d.setDate(t.getDate()+i);const lbl=`${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}`;const btn=document.createElement('button');btn.textContent=lbl;btn.onclick=()=>{c.querySelectorAll('button').forEach(x=>x.classList.remove('active'));btn.classList.add('active');selectedDate=lbl;txt.textContent=lbl;updateSessionUI();};if(i===0){btn.classList.add('active');selectedDate=lbl;txt.textContent=lbl;}c.appendChild(btn);}updateSessionUI();}
    function updateSessionUI(){const reg=state.registrations.find(r=>r.date===selectedDate);document.getElementById('registrationBox').style.display=reg?'none':'block';document.getElementById('joinContainer').style.display=reg?'block':'none';document.getElementById('products').style.display='none';}
    function showRegisterModal(){if(state.walletBalance<20000) return alert('Kh√¥ng ƒë·ªß 20 000 SMP');document.getElementById('registerModal').classList.add('show');}
    function closeRegisterModal(){document.getElementById('registerModal').classList.remove('show');}
    function confirmRegister(){state.walletBalance-=20000;updateWallet();addWalletHistory('Ph√≠ ƒëƒÉng k√Ω phi√™n',-20000);state.registrations.push({date:selectedDate,time:Date.now()});closeRegisterModal();updateSessionUI();updateVipLevel();alert(`ƒê√£ ƒëƒÉng k√Ω phi√™n ${selectedDate}`);}
    function joinSession(){if(!state.registrations.find(r=>r.date===selectedDate)) return alert('Ch∆∞a ƒëƒÉng k√Ω phi√™n');document.getElementById('products').style.display='block';renderProducts();renderPendingSales();}

    // ===== Products & Buy =====
    function renderProducts(){const c=document.getElementById('productList');c.innerHTML='';state.products.forEach(p=>{const d=document.createElement('div');d.className='product';d.style.background=randomColor();d.innerHTML=`<b>${p.name}</b><br>ID: ${p.id}<br>Gi√°: ${fmt(p.price)} SMP<br><button class="small" onclick="confirmBuy('${p.id}')">Mua</button>`;c.appendChild(d);});}
    function confirmBuy(id){const p=state.products.find(x=>x.id===id),sale=state.pendingSales.find(x=>x.id===id);if(!p&&!sale) return alert('Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m');let name,price,seller;if(sale){name=sale.name;price=sale.salePrice;seller=sale.seller;state.pendingSales=state.pendingSales.filter(x=>x.id!==id);const idx=state.userNFT.findIndex(x=>x.id===id&&x.status==='pendingSale');if(idx>=0)state.userNFT.splice(idx,1);}else{name=p.name;price=p.price;seller=p.seller;state.products=state.products.filter(x=>x.id!==id);}state.userNFT.push({id,name,price,seller,status:'bought',postTime:sale? sale.postTime:null,sellDate:sale? sale.sellDate:null});state.nftHistory.unshift({id,name,price,time:new Date().toLocaleString('vi-VN'),action:'Mua'});renderProducts();renderPendingSales();renderNFTs();renderNFTHistory();alert(`ƒê√£ mua "${name}" gi√° ${fmt(price)} SMP (ch·ªù thanh to√°n).`);}    

    // ===== Pending Sales =====
    function renderPendingSales(){const c=document.getElementById('pendingSaleList');c.innerHTML='';state.pendingSales.filter(s=>s.sellDate===selectedDate).forEach(s=>{const d=document.createElement('div');d.className='sale-item';d.style.background=randomColor();d.innerHTML=`<b>${s.name}</b><br>ID: ${s.id}<br>Gi√° b√°n: ${fmt(s.salePrice)} SMP<br>Th·ªùi gian g·ª≠i b√°n: ${new Date(s.postTime).toLocaleString('vi-VN')}<br>Phi√™n b√°n: ${s.sellDate}<br>Ng∆∞·ªùi b√°n: ${s.seller}<br><button class="small" onclick="confirmBuy('${s.id}')">Mua</button>`;c.appendChild(d);});}

    // ===== NFT Display =====
    function renderNFTs(){const c=document.getElementById('nftList');let tot=0;c.innerHTML='';if(!state.userNFT.length){c.textContent='Ch∆∞a c√≥ s·∫£n ph·∫©m.';document.getElementById('totalSpent').innerText='0';return;}state.userNFT.forEach(it=>{tot+=it.price;let extra='';if(it.status==='bought'){extra=`<p>Ng∆∞·ªùi b√°n: <b>${it.seller}</b></p><button class="small" onclick="showPaymentConfirm('${it.id}')">Thanh to√°n ${fmt(it.price)} SMP</button>`;}else if(it.status==='paid'){extra=`<button class="small" onclick="initSell('${it.id}')">B√°n</button>`;}else if(it.status==='opened'){extra=`<p>Ho√†n ${fmt(it.refund)} SMP</p>`;}else if(it.status==='pendingSale'){extra=`<p>Gi√° b√°n: ${fmt(it.salePrice)} SMP</p><p>Th·ªùi gian g·ª≠i b√°n: ${new Date(it.postTime).toLocaleString('vi-VN')}</p><p>Phi√™n b√°n: ${it.sellDate}</p><p>Ng∆∞·ªùi b√°n: <b>${it.seller}</b></p><p style="color:#ffc107;">(ƒêang treo b√°n)</p>`;}const d=document.createElement('div');d.className='nft-item';d.style.background=randomColor();d.innerHTML=`<b>${it.name}</b><br>ID: ${it.id}<br>${extra}`;c.appendChild(d);});document.getElementById('totalSpent').innerText=fmt(tot);}    

    // ===== Payment Confirmation =====
    function showPaymentConfirm(id){const it=state.userNFT.find(x=>x.id===id&&x.status==='bought');if(!it)return; if(!confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën thanh to√°n ${fmt(it.price)} SMP cho ${it.seller}?`))return; state.walletBalance-=it.price;updateWallet();addWalletHistory(`Thanh to√°n ${it.name}`,-it.price);alert(`ƒê√£ chuy·ªÉn ${fmt(it.price)} SMP cho ${it.seller}`);it.status='paid';state.nftHistory.unshift({id:it.id,name:it.name,price:it.price,time:new Date().toLocaleString('vi-VN'),action:'Thanh to√°n'});renderNFTs();renderNFTHistory();}

    // ===== Sell Flow =====
    function initSell(id){const it=state.userNFT.find(x=>x.id===id&&x.status==='paid');if(!it)return;const profit=Math.floor(it.price*vipRate()/100),fee=Math.ceil(it.price*0.034),salePrice=it.price+profit+fee,postTime=Date.now();sellContext={it,profit,fee,salePrice,postTime};document.getElementById('sellId').innerText=id;document.getElementById('sellCost').innerText=fmt(it.price);document.getElementById('sellProfit').innerText=fmt(profit);document.getElementById('sellFee').innerText=fmt(fee);document.getElementById('sellModal').classList.add('show');}
    function closeSellModal(){document.getElementById('sellModal').classList.remove('show');}
    function confirmSell(){const {it,profit,fee,salePrice,postTime}=sellContext;if(state.walletBalance<fee)return alert('Kh√¥ng ƒë·ªß ph√≠');state.walletBalance-=fee;updateWallet();addWalletHistory(`Ph√≠ g·ª≠i b√°n ${it.name}`,-fee);const sLevel=parseInt(document.getElementById('sLevel').innerText.slice(1),10);if(sLevel>=1){const teamComm=Math.ceil(salePrice*(parseFloat(document.getElementById('sCommissionRate').innerText)/100));state.rankCommission+=teamComm;}const directComm=Math.ceil(salePrice*0.004);state.directCommission+=directComm;it.status='pendingSale';it.salePrice=salePrice;it.postTime=postTime;it.sellDate=(()=>{
n=new Date();n.setDate(n.getDate()+1);return`${String(n.getDate()).padStart(2,'0')}/${String(n.getMonth()+1).padStart(2,'0')}`;})();it.seller=currentUsername;state.pendingSales.push({id:it.id,name:it.name,salePrice,seller:currentUsername,sellDate:it.sellDate,postTime});state.teamSales+=salePrice;updateSLevel();updateCommissionUI();state.nftHistory.unshift({id:it.id,name:it.name,price:salePrice,time:new Date().toLocaleString('vi-VN'),action:'G·ª≠i b√°n'});renderNFTs();renderPendingSales();renderNFTHistory();closeSellModal();alert(`ƒê√£ g·ª≠i b√°n "${it.name}" trong phi√™n ${it.sellDate}`);}    

    // ===== Wallet / Deposit / Withdraw / Transfer / History =====
    function showDeposit(){document.getElementById('depositModal').classList.add('show');}
    function closeDepositModal(){document.getElementById('depositModal').classList.remove('show');}
    document.getElementById('depositSMP')?.addEventListener('input',e=>{const v=parseFloat(e.target.value)||0;document.getElementById('requiredUSDT').innerText=`C·∫ßn: ${(v/state.usdtPrice).toFixed(4)} USDT`;});
    function submitDeposit(){const v=parseFloat(document.getElementById('depositSMP').value);if(isNaN(v)||v<=0)return alert('Nh·∫≠p s·ªë h·ª£p l·ªá');const usdt=(v/state.usdtPrice).toFixed(4);state.requests.unshift({id:randomId(),type:'deposit',SMP:v,usdt,address:document.getElementById('depositAddress').innerText,time:new Date().toLocaleString('vi-VN'),status:'pending'});renderRequestHistory();closeDepositModal();alert('Y√™u c·∫ßu n·∫°p ƒë√£ g·ª≠i, ch·ªù duy·ªát.');}
    function copyAddress(){navigator.clipboard.writeText(document.getElementById('depositAddress').innerText).then(()=>alert('ƒê√£ sao ch√©p!'));}

    function showWithdraw(){document.getElementById('withdrawModal').classList.add('show');}
    function closeWithdrawModal(){document.getElementById('withdrawModal').classList.remove('show');}
    function submitWithdraw(){const v=parseFloat(document.getElementById('withdrawAmt').value);if(isNaN(v)||v<1000000)return alert('Min r√∫t l√† 1 000 000');if(v>state.walletBalance)return alert('S·ªë d∆∞ kh√¥ng ƒë·ªß');state.requests.unshift({id:randomId(),type:'withdraw',SMP:v,usdt:0,address:'',time:new Date().toLocaleString('vi-VN'),status:'pending'});renderRequestHistory();closeWithdrawModal();alert('Y√™u c·∫ßu r√∫t ƒë√£ g·ª≠i.');}

    function showTransfer(){document.getElementById('walletAction').innerHTML=`<h3>Chuy·ªÉn n·ªôi b·ªô</h3><input id=\"transferTo\" placeholder=\"ID th√†nh vi√™n\"/><input id=\"transferAmt\" type=\"number\" placeholder=\"S·ªë SMP\"/><button onclick=\"submitTransfer()\">Chuy·ªÉn</button>`;}
    function submitTransfer(){const to=document.getElementById('transferTo').value.trim(),amt=parseFloat(document.getElementById('transferAmt').value);if(isNaN(amt)||amt<=0)return alert('S·ªë kh√¥ng h·ª£p l·ªá');if(amt>state.walletBalance)return alert('S·ªë d∆∞ kh√¥ng ƒë·ªß');if(!state.members||!state.members.includes(to))return alert('ID kh√¥ng t·ªìn t·∫°i');state.walletBalance-=amt;updateWallet();addWalletHistory(`Chuy·ªÉn cho ${to}`,-amt);document.getElementById('walletAction').innerHTML='';}

    function renderWalletHistory(){const c=document.getElementById('walletHistory');if(!state.walletHistory.length){c.textContent='Ch∆∞a c√≥ giao d·ªãch.';return;}c.innerHTML=state.walletHistory.map(h=>`<div>${h.time}: <span class=\"${h.delta<0?'neg':'pos'}\">${h.delta>0?'+':''}${fmt(h.delta)}</span> ‚Äì ${h.desc}</div>`).join('');}
    function renderRequestHistory(){document.getElementById('requestHistory').innerHTML=state.requests.map(r=>`<tr><td>${r.type}</td><td>${fmt(r.SMP)}</td><td>${r.usdt}</td><td>${r.address}</td><td>${r.time}</td><td>${r.status}</td></tr>`).join('');}
    function renderNFTHistory(){const ul=document.getElementById('nftHistory');if(!state.nftHistory.length){ul.textContent='Ch∆∞a c√≥ l·ªãch s·ª≠.';return;}ul.innerHTML=state.nftHistory.map(x=>`<li>${x.time}: [${x.action}] ${x.name} ‚Äî ${fmt(x.price)} SMP</li>`).join('');}

    function updateVipLevel(){const days=state.registrations.length,th=[0,10,20,40,60,90],rt=[1.5,1.6,1.7,1.8,1.9,2.0];let lvl=0;th.forEach((t,i)=>{if(days>=t)lvl=i;});document.getElementById('vipDays').innerText=days;document.getElementById('vipLevel').innerText='VIP'+lvl;document.getElementById('vipProfitRate').innerText=rt[lvl]+'%';}
    function updateSLevel(){const sales=state.teamSales,th=[0,58000000,150000000,1000000000,3000000000,7000000000],cm=[0,0.2,0.3,0.4,0.6,0.8];let lvl=0;th.forEach((t,i)=>{if(sales>=t)lvl=i;});document.getElementById('sLevel').innerText='S'+lvl;document.getElementById('sCommissionRate').innerText=cm[lvl]+'%';}

    function withdrawDirect(){if(state.directCommission<=0)return alert('Kh√¥ng c√≥ hoa h·ªìng tr·ª±c ti·∫øp.');state.walletBalance+=state.directCommission;addWalletHistory('R√∫t hoa h·ªìng tr·ª±c ti·∫øp',+state.directCommission);state.directCommission=0;updateWallet();updateCommissionUI();}
    function withdrawRank(){if(state.rankCommission<=0)return alert('Kh√¥ng c√≥ hoa h·ªìng c·∫•p b·∫≠c.');state.walletBalance+=state.rankCommission;addWalletHistory('R√∫t hoa h·ªìng c·∫•p b·∫≠c',+state.rankCommission);state.rankCommission=0;updateWallet();updateCommissionUI();}

    function saveProfile(){alert('ƒê√£ l∆∞u th√¥ng tin');}
  </script>
</body>
</html>
